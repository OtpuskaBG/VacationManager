@page "/leaveRequests/details/{LRId}"

@using AutoMapper
@using VacationManager.Data.Models
@using VacationManager.Core.Services.Abstractions
@using VacationManager.Core.Authentication.Abstractions
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@using VacationManager.Models.LeaveRequest

@inject ILeaveRequestService LeaveRequestService
@inject IMapper Mapper
@inject NavigationManager Navigation

<h3>Leave Request Details</h3>

@if (leaveRequest == null)
{
    <p class="text-danger">Request not found.</p>
}
else
{
    <div class="mb-3">
        <strong>User:</strong> @leaveRequest.User?.FirstName @leaveRequest.User?.LastName
    </div>
    <div class="mb-3">
        <strong>Type:</strong> @leaveRequest.Type
    </div>
    <div class="mb-3">
        <strong>Start Date:</strong> @leaveRequest.StartDate.ToShortDateString()
    </div>
    <div class="mb-3">
        <strong>End Date:</strong> @leaveRequest.EndDate.ToShortDateString()
    </div>
    <div class="mb-3">
        <strong>Half Day:</strong> @(leaveRequest.HalfDay ? "Yes" : "No")
    </div>
    <div class="mb-3">
        <strong>Requested On:</strong> @leaveRequest.RequestDate.ToShortDateString()
    </div>
    <div class="mb-3">
        <strong>Attachment:</strong> @(!string.IsNullOrWhiteSpace(leaveRequest.AttachmentPath) ? leaveRequest.AttachmentPath : "N/A")
    </div>
    <div class="mb-3">
        <strong>Approved:</strong> @(leaveRequest.Approved ? "Yes" : "No")
    </div>

    <button class="btn btn-secondary" @onclick="NavigateBack">Back</button>
}

@code {
    [Parameter] public Guid LRId { get; set; }

    private LeaveRequestViewModel? leaveRequest;

    protected override async Task OnInitializedAsync()
    {
        var data = await LeaveRequestService.GetByIdAsync(LRId, default);
        if (data != null)
        {
            leaveRequest = Mapper.Map<LeaveRequestViewModel>(data);
        }
    }

    private void NavigateBack()
    {
        Navigation.NavigateTo("/leaveRequests");
    }
}
